(window["webpackJsonpbtc-ownership-transfer"]=window["webpackJsonpbtc-ownership-transfer"]||[]).push([[0],{112:function(e,t,n){"use strict";(function(e){var a=n(14),r=n(15),s=n(17),i=n(16),o=n(9),c=n(18),l=n(0),u=n.n(l),d=n(6),p=n(4),m=function(t){function n(e){var t;return Object(a.a)(this,n),(t=Object(s.a)(this,Object(i.a)(n).call(this,e))).getActionButtons=t.getActionButtons.bind(Object(o.a)(t)),t.addTxWrapper=t.addTxWrapper.bind(Object(o.a)(t)),t.sendToOwnerWrapper=t.sendToOwnerWrapper.bind(Object(o.a)(t)),t.sendToHeirWrapper=t.sendToHeirWrapper.bind(Object(o.a)(t)),t}return Object(c.a)(n,t),Object(r.a)(n,[{key:"getActionButtons",value:function(e){var t={addTx:u.a.createElement("button",{onClick:this.addTxWrapper},"Sign intermediate tx"),sendToOwner:u.a.createElement("button",{onClick:this.sendToOwnerWrapper},"Widthraw to owner"),sendToHeir:u.a.createElement("button",{onClick:this.sendToHeirWrapper},"Widthraw to heir")};return Object.keys(e).map((function(e,n){return t[e]?u.a.createElement("div",{key:n},t[e]):""}))}},{key:"addTxWrapper",value:function(){var e=p.a.network,t=d.b(this.props.owner.mnemonic,this.props.owner.derivationPath,e),n=d.b(this.props.heir.mnemonic,this.props.heir.derivationPath,e),a=d.f({childOwner:t.child,childHeir:n.child,txid:this.props.utxo.transaction_hash,output:this.props.utxo.index,amount:this.props.utxo.value,fee:p.a.fee,sequenceFeed:p.a.sequenceFeed,network:e});Object.assign(a,{info:{owner:t.address,heir:n.address,amount:this.props.utxo.value,fee:p.a.fee,sequenceFeed:p.a.sequenceFeed}}),this.props.actions.addTx(a)}},{key:"sendToOwnerWrapper",value:function(){var t=p.a.network,n=d.b(this.props.owner.mnemonic,this.props.owner.derivationPath,t),a=n.child,r=n.address,s=d.e({childPerson:a,redeemScript:e.from(this.props.redeem,"hex"),txid:this.props.utxo.transaction_hash,output:this.props.utxo.index,amount:this.props.utxo.value,fee:p.a.fee,network:t});d.a(s.toHex()),this.props.actions.sendToOwner(r)}},{key:"sendToHeirWrapper",value:function(){var t=p.a.network,n=d.b(this.props.heir.mnemonic,this.props.heir.derivationPath,t),a=n.child,r=n.address,s=d.d({childPerson:a,redeemScript:e.from(this.props.redeem,"hex"),txid:this.props.utxo.transaction_hash,output:this.props.utxo.index,amount:this.props.utxo.value,fee:p.a.fee,sequenceFeed:p.a.sequenceFeed,network:t});d.a(s.toHex()),this.props.actions.sendToHeir(r)}},{key:"render",value:function(){var e=-1===this.props.utxo.block_id?"Unconfirmed":this.props.blocks?this.props.blocks-this.props.utxo.block_id+1:"Loading...";return u.a.createElement("div",{style:{wordWrap:"break-word"}},u.a.createElement("p",null,u.a.createElement("strong",null,"UTXO ",this.props.index+1)),u.a.createElement("span",null,"Tx hash: ",this.props.utxo.transaction_hash),u.a.createElement("br",null),u.a.createElement("span",null,"Index: ",this.props.utxo.index),u.a.createElement("br",null),u.a.createElement("span",null,"Value: ",this.props.utxo.value/Math.pow(10,8)+" BTC"),u.a.createElement("br",null),u.a.createElement("span",null,"Block: ",this.props.utxo.block_id),u.a.createElement("br",null),u.a.createElement("span",null,"Confirmations: ",e),u.a.createElement("br",null),u.a.createElement("br",null),this.getActionButtons(this.props.actions),u.a.createElement("br",null),u.a.createElement("br",null))}}]),n}(u.a.Component);t.a=m}).call(this,n(1).Buffer)},113:function(e,t,n){e.exports=n(248)},124:function(e,t){},126:function(e,t){},144:function(e,t){},147:function(e,t){},248:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(111),i=n.n(s),o=(n(118),n(23)),c=n.n(o),l=n(34),u=n(46),d=n(14),p=n(15),m=n(17),h=n(16),b=n(9),f=n(18),v=n(112),k=n(35),E=n.n(k),w=n(4),x=n(6),O=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).loadingUTXOs=!1,n.state={needToRerenderUTXOs:!1,utxos:[]},n.updateUTXOList=n.updateUTXOList.bind(Object(b.a)(n)),n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.updateUTXOList(this.props.address)}},{key:"shouldComponentUpdate",value:function(e,t){return e.address!==this.props.address||e.statsTime!==this.props.statsTime?(this.updateUTXOList(e.address),!0):t.needToRerenderUTXOs}},{key:"componentDidUpdate",value:function(e,t,n){!t&&this.state.needToRerenderUTXOs&&this.setState({needToRerenderUTXOs:!1})}},{key:"updateUTXOList",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x.g(t).isValid){e.next=2;break}return e.abrupt("return");case 2:return this.loadingUTXOs=!0,n="".concat(w.a.apiURIs.address,"/").concat(t),e.next=6,E.a.get(n).catch((function(e){return alert("Blockchain API request error: "+e)}));case 6:a=e.sent,console.log("Fetching for address utxos from ".concat(n)),this.loadingUTXOs=!1,this.setState({needToRerenderUTXOs:!0,utxos:a.data.data[t].utxo});case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAllUtxo",value:function(){var e=this;if(this.loadingUTXOs)return r.a.createElement("div",null,"Loading...");var t=this.state.utxos;return t.length?t.map((function(t,n){return r.a.createElement(v.a,{key:n,index:n,utxo:t,redeem:e.props.redeem,actions:e.props.actions,blocks:e.props.blocks,owner:e.props.owner,heir:e.props.heir})})):r.a.createElement("div",null,"No UTXOs")}},{key:"getHeader",value:function(){var e=x.g(this.props.address),t=this.props.redeem?r.a.createElement("span",null,r.a.createElement("b",null,"Redeem: "),r.a.createElement("br",null),this.props.redeem):"",n=this.props.info?r.a.createElement("span",null,r.a.createElement("b",null,"Info: "),r.a.createElement("br",null),JSON.stringify(this.props.info,null,"\t")):"";return e.isValid?r.a.createElement("div",{style:{wordWrap:"break-word"}},r.a.createElement("h4",null,this.props.address),t?r.a.createElement("p",null,r.a.createElement("br",null),t,r.a.createElement("br",null)):"",n?r.a.createElement("p",null,n,r.a.createElement("br",null)):"",r.a.createElement("br",null)):r.a.createElement("h4",null,"Address is not valid: ",e.message)}},{key:"render",value:function(){return r.a.createElement("div",{className:"content"},this.getHeader(),this.getAllUtxo())}}]),t}(r.a.Component),g=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props,t=e.person,n=e.owner,a=e.heir,s=e.updateMnemonic,i=e.blocks,o=e.statsTime,c=e.actions,l=this.props[t],u=l.derivationPath,d=l.mnemonic,p=w.a[t].name,m=w.a.network,h=(Object(x.c)(d)?Object(x.b)(d,u,m):{}).address;return r.a.createElement("div",{className:"ui card"},r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"header"},p)),r.a.createElement("div",{className:"content"},r.a.createElement("form",null,r.a.createElement("label",{htmlFor:"mnemonic"}),r.a.createElement("br",null),r.a.createElement("textarea",{id:"mnemonic",name:"mnemonic",cols:"30",rows:"3",onChange:function(e){return s(t,e.target.value)},defaultValue:d})),r.a.createElement("p",{style:{color:"red"}},Object(x.c)(d)?"":"Mnemonic is not valid! Please enter valid mnemonic"),r.a.createElement("p",null,"Derivation path: ",u)),r.a.createElement("div",{className:"content"},r.a.createElement(O,{address:h,actions:c,blocks:i,statsTime:o,owner:n,heir:a})))}}]),t}(r.a.Component),y=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).broadcast=n.broadcast.bind(Object(b.a)(n)),n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"broadcast",value:function(){x.a(this.props.tx.raw),this.props.removeTx(this.props.tx.id),this.props.addIntermediate({address:this.props.tx.address,redeem:this.props.tx.redeem,info:this.props.tx.info})}},{key:"render",value:function(){return r.a.createElement("div",{className:"content",style:{wordWrap:"break-word"}},r.a.createElement("h4",null,"Txid: ",this.props.tx.id),r.a.createElement("p",null,this.props.tx.raw),r.a.createElement("p",null,JSON.stringify(this.props.tx.info,null,"\t")),r.a.createElement("p",null,r.a.createElement("button",{onClick:this.broadcast},"Broadcast")))}}]),t}(r.a.Component);var T=function(e){return r.a.createElement("div",{className:"ui card"},r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"header"},"Transactions")),e.txs.map((function(t,n){return r.a.createElement(y,{key:n,tx:t,removeTx:e.removeTx,addIntermediate:e.addIntermediate})})))},j=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(p.a)(t,[{key:"getAddressUtxoLists",value:function(){var e=this;return this.props.addressesData.map((function(t,n){return r.a.createElement(O,{key:n,address:t.address,redeem:t.redeem,info:t.info,actions:e.props.actions,blocks:e.props.blocks,statsTime:e.props.statsTime,owner:e.props.owner,heir:e.props.heir})}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"ui card"},r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"header"},"Intermediate addresses")),this.getAddressUtxoLists())}}]),t}(r.a.Component),S=function(e){function t(e){var n;Object(d.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).state={owner:w.a.owner,heir:w.a.heir,network:w.a.network,blocks:void 0,statsTime:void 0};var a=n.state,r=a.owner,s=a.heir,i=a.network;return Object.assign(n.state,n.getStorage(r,s,i)),n.updateMnemonic=n.updateMnemonic.bind(Object(b.a)(n)),n.addTx=n.addTx.bind(Object(b.a)(n)),n.removeTx=n.removeTx.bind(Object(b.a)(n)),n.addIntermediate=n.addIntermediate.bind(Object(b.a)(n)),n.removeIntermediate=n.removeIntermediate.bind(Object(b.a)(n)),n.refresh=n.refresh.bind(Object(b.a)(n)),n.refresh(),n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"getStorageKey",value:function(e,t,n){var a=Object(x.b)(e.mnemonic,e.derivationPath,n).address,r=Object(x.b)(t.mnemonic,t.derivationPath,n).address;return"".concat(a,"_").concat(r)}},{key:"getStorage",value:function(e,t,n){var a=JSON.parse(localStorage.getItem(this.getStorageKey(e,t,n)));return{intermediate:a?a.intermediate:[],txs:a?a.txs:[]}}},{key:"setStorage",value:function(e){var t=e.owner,n=e.heir,a=e.network,r=e.storage;localStorage.setItem(this.getStorageKey(t,n,a),JSON.stringify(r))}},{key:"updateMnemonic",value:function(e,t){var n=this.state,a=n.owner,r=n.heir,s=n.network;"owner"===e?a.mnemonic=t:r.mnemonic=t;var i=this.getStorage(a,r,s),o=Object.assign({},this.state,Object(u.a)({},e,Object.assign({},this.state[e],{mnemonic:t})),i);this.setState((function(e,t){return o}))}},{key:"addStateData",value:function(e,t,n){var a,r=this;if(0===this.state[t].filter((function(t){return t[n]===e[n]})).length)a=this.state[t].concat([e]);else{var s=(a=this.state[t].slice()).indexOf((function(t){return t[n]===e[n]}));a[s]=e}this.setState((function(e){var n=r.state,s=n.owner,i=n.heir,o=n.network,c=r.getStorage(s,i,o);return c[t]=a,r.setStorage({owner:s,heir:i,network:o,storage:c}),Object(u.a)({},t,a)}))}},{key:"removeStateData",value:function(e,t,n){var a=this,r=this.state[e].filter((function(e){return e[t]===n}));if(0!==r.length){var s=this.state[e].slice(),i=this.state[e].indexOf(r[0]);s.splice(i,1),this.setState((function(t){var n=a.state,r=n.owner,i=n.heir,o=n.network,c=a.getStorage(r,i,o);return c[e]=s,a.setStorage({owner:r,heir:i,network:o,storage:c}),Object(u.a)({},e,s)}))}}},{key:"addTx",value:function(e){this.addStateData(e,"txs","id")}},{key:"removeTx",value:function(e){this.removeStateData("txs","id",e)}},{key:"addIntermediate",value:function(e){this.addStateData(e,"intermediate","address")}},{key:"removeIntermediate",value:function(e){this.removeStateData("intermediate","address",e)}},{key:"refresh",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=w.a.apiURIs.stats,console.log("Fetching for blockchain stats from ".concat(t)),e.next=4,E.a.get(t).catch((function(e){return alert("Blockchain API request error: "+e)}));case 4:n=e.sent,this.setState({blocks:n.data.data.blocks,statsTime:Date.now()});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=r.a.createElement("button",{onClick:function(){return e.refresh()}},r.a.createElement("b",null,"Refresh Blockchain data"));return r.a.createElement("div",{className:"ui container"},r.a.createElement("br",null),r.a.createElement("h2",{className:"ui header center aligned"},"Bitcoin safe inheritance"),r.a.createElement("p",null,"This Proof-of-Concept represents secure and convenient Bitcoin transfer from owner to heir(recovery) party in case if owner's keys are lost or some accident happens. This is trustless model between owner and heir as long as owner has exclusive control of her private keys. Heir delay time is fixed and equals to 6 Bitcoin blocks."),r.a.createElement("p",null,"Please refere to ",r.a.createElement("a",{href:"https://bitcointalk.org/index.php?topic=5185907.0"},"this Bitcointalk discussion")," for more motivation info and details."),r.a.createElement("p",{style:{color:"red"}},"It works on Bitcoin TESTNET. Please DON'T use mnemonics from your Bitcoin mainnet funds! That is potentially not safe and may cause your funds to be lost forever."),r.a.createElement("p",{align:"center"},t),r.a.createElement("div",{className:"ui four column doubling stackable grid container"},r.a.createElement("div",{className:"column"},r.a.createElement(g,{person:"owner",owner:this.state.owner,heir:this.state.heir,updateMnemonic:this.updateMnemonic,actions:{addTx:this.addTx},blocks:this.state.blocks,statsTime:this.state.statsTime})),r.a.createElement("div",{className:"column"},r.a.createElement(T,{txs:this.state.txs,removeTx:this.removeTx,addIntermediate:this.addIntermediate})),r.a.createElement("div",{className:"column"},r.a.createElement(j,{addressesData:this.state.intermediate,actions:{sendToOwner:this.removeIntermediate,sendToHeir:this.removeIntermediate},blocks:this.state.blocks,statsTime:this.state.statsTime})),r.a.createElement("div",{className:"column"},r.a.createElement(g,{person:"heir",owner:this.state.owner,heir:this.state.heir,updateMnemonic:this.updateMnemonic,actions:{},blocks:this.state.blocks,statsTime:this.state.statsTime}))),r.a.createElement("h3",null,"Bitcoin testnet faucet"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("a",{href:"https://coinfaucet.eu/en/btc-testnet/"},"https://coinfaucet.eu/en/btc-testnet/"))),r.a.createElement("h3",null,"Source code"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("a",{href:"https://github.com/AndriianChestnykh/btc-safe-inherinance"},"https://github.com/AndriianChestnykh/btc-safe-inherinance"))),r.a.createElement("h3",null,"Libraries"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("a",{href:"https://github.com/bitcoinjs/bitcoinjs-lib"},"BitcoinJS")),r.a.createElement("li",null,r.a.createElement("a",{href:"https://github.com/bitcoinjs/bip39"},"bip39")),r.a.createElement("li",null,r.a.createElement("a",{href:"https://github.com/bitcoinjs/bip68"},"bip68"))),r.a.createElement("h3",null,"Blockchain API providers"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("a",{href:"https://blockchair.com/"},"Blockchair"))))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(S,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},4:function(e,t,n){"use strict";var a=n(3),r=a.networks.testnet,s=new Map([[a.networks.testnet,"bitcoin/testnet"],[a.networks.bitcoin,"bitcoin"]]),i={network:r,apiURIs:{address:"https://api.blockchair.com/".concat(s.get(r),"/dashboards/address"),pushTx:"https://api.blockchair.com/".concat(s.get(r),"/push/transaction"),stats:"https://api.blockchair.com/".concat(s.get(r),"/stats")},owner:{name:"Alice (owner)",mnemonic:"",derivationPath:"m/44'/1'/0'/0/0"},heir:{name:"Bob (heir)",mnemonic:"",derivationPath:"m/44'/1'/0'/0/0"},sequenceFeed:{blocks:6},fee:1e4};t.a=i},6:function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return f})),n.d(t,"f",(function(){return v})),n.d(t,"e",(function(){return k})),n.d(t,"d",(function(){return E})),n.d(t,"g",(function(){return x})),n.d(t,"a",(function(){return O})),n.d(t,"c",(function(){return y}));var a=n(23),r=n.n(a),s=n(34),i=n(3),o=n(68),c=n(69),l=n(70),u=n.n(l),d=n(4),p=n(32),m=n.n(p),h=n(35),b=n.n(h);function f(e,t,n){var a=c.mnemonicToSeedSync(e),r=o.fromSeed(a).derivePath(t);return{child:r,address:i.payments.p2pkh({pubkey:r.publicKey,network:n}).address,publicKey:r.publicKey}}function v(e){var t=e.childOwner,n=e.childHeir,a=e.txid,r=e.output,s=e.amount,o=e.fee,c=e.sequenceFeed,l=e.network,p=function(e,t,n){var a=i.script.number.encode(n).toString("hex"),r=e.pubkey.toString("hex"),s=t.pubkey.toString("hex");return i.script.fromASM("\n      OP_IF\n        ".concat(r,"\n        OP_CHECKSIG\n      OP_ELSE\n        ").concat(a,"\n        OP_CHECKSEQUENCEVERIFY\n        OP_DROP\n        ").concat(s,"\n        OP_CHECKSIG\n      OP_ENDIF\n    ").trim().replace(/\s+/g," "))}(i.payments.p2pkh({pubkey:t.publicKey,network:l}),i.payments.p2pkh({pubkey:n.publicKey,network:l}),u.a.encode(c)),m=i.payments.p2sh({redeem:{output:p},network:d.a.network}),h=new i.TransactionBuilder(l);h.addInput(a,r),h.addOutput(m.address,s-o);var b=i.ECPair.fromPrivateKey(t.privateKey,{compressed:!0,network:l});h.sign(0,b);var f=h.build();return{raw:f.toHex(),id:f.getId(),redeem:p.toString("hex"),lockFeed:c,address:m.address}}function k(e){return w(!0,e)}function E(e){return w(!1,e)}function w(t,n){var a=n.childPerson,r=n.redeemScript,s=n.txid,o=n.output,c=n.amount,l=n.fee,d=n.network,p=n.sequenceFeed,m=i.payments.p2sh({redeem:{output:r},network:d}),h=i.payments.p2pkh({pubkey:a.publicKey,network:d}),b=new i.Transaction;b.version=2,t?b.addInput(e.from(s,"hex").reverse(),o):b.addInput(e.from(s,"hex").reverse(),o,u.a.encode(p)),b.addOutput(i.address.toOutputScript(h.address,d),c-l);var f=b.hashForSignature(0,m.redeem.output,i.Transaction.SIGHASH_ALL),v=i.ECPair.fromPrivateKey(a.privateKey,{compressed:!0,network:d}),k=t?i.opcodes.OP_TRUE:i.opcodes.OP_0,E=i.payments.p2sh({network:d,redeem:{network:d,output:m.redeem.output,input:i.script.compile([i.script.signature.encode(v.sign(f),i.Transaction.SIGHASH_ALL),k])}}).input;return b.setInputScript(0,E),b}function x(e){var t,n=!1;try{t=(n=21===m.a.decode(e).length)?"":"Wrong address length"}catch(a){t="Error decoding base58check: "+a.message}return{isValid:n,message:t}}function O(e){return g.apply(this,arguments)}function g(){return(g=Object(s.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.a.apiURIs.pushTx,e.next=3,b.a.post(n,{data:t},{headers:{"Content-Type":"application/json;charset=UTF-8"}}).catch((function(e){return alert("Blockchain API request error: "+e)}));case 3:e.sent&&alert("Tx was broadcasted successfully!");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return c.validateMnemonic(e)}}).call(this,n(1).Buffer)}},[[113,1,2]]]);
//# sourceMappingURL=main.5d9f1412.chunk.js.map