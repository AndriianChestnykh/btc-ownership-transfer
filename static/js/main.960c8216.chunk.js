(window["webpackJsonpbtc-ownership-transfer"]=window["webpackJsonpbtc-ownership-transfer"]||[]).push([[0],{112:function(e,t,n){"use strict";(function(e){var a=n(14),r=n(15),i=n(17),o=n(16),s=n(9),c=n(18),d=n(0),u=n.n(d),l=n(6),p=n(3),m=function(t){function n(e){var t;return Object(a.a)(this,n),(t=Object(i.a)(this,Object(o.a)(n).call(this,e))).getActionButtons=t.getActionButtons.bind(Object(s.a)(t)),t.addTxWrapper=t.addTxWrapper.bind(Object(s.a)(t)),t.sendToOwnerWrapper=t.sendToOwnerWrapper.bind(Object(s.a)(t)),t.sendToHeirWrapper=t.sendToHeirWrapper.bind(Object(s.a)(t)),t}return Object(c.a)(n,t),Object(r.a)(n,[{key:"getActionButtons",value:function(e){var t={addTx:u.a.createElement("button",{onClick:this.addTxWrapper},"Sign intermediate tx"),sendToOwner:u.a.createElement("button",{onClick:this.sendToOwnerWrapper},"Widthraw to owner"),sendToHeir:u.a.createElement("button",{onClick:this.sendToHeirWrapper},"Widthraw to heir")};return Object.keys(e).map((function(e,n){return t[e]?u.a.createElement("div",{key:n},t[e]):""}))}},{key:"addTxWrapper",value:function(){var e=p.a.network,t=l.b(p.a.owner.mnemonic,p.a.owner.derivationPath,e),n=l.b(p.a.heir.mnemonic,p.a.heir.derivationPath,e),a=l.f({childOwner:t.child,childHeir:n.child,txid:this.props.utxo.transaction_hash,output:this.props.utxo.index,amount:this.props.utxo.value,fee:p.a.fee,sequenceFeed:p.a.sequenceFeed,network:e});Object.assign(a,{info:{owner:t.address,heir:n.address,amount:this.props.utxo.value,fee:p.a.fee,sequenceFeed:p.a.sequenceFeed}}),this.props.actions.addTx(a)}},{key:"sendToOwnerWrapper",value:function(){var t=p.a.network,n=l.b(p.a.owner.mnemonic,p.a.owner.derivationPath,t),a=n.child,r=n.address,i=l.e({childPerson:a,redeemScript:e.from(this.props.redeem,"hex"),txid:this.props.utxo.transaction_hash,output:this.props.utxo.index,amount:this.props.utxo.value,fee:p.a.fee,network:t});l.a(i.toHex()),this.props.actions.sendToOwner(r)}},{key:"sendToHeirWrapper",value:function(){var t=p.a.network,n=l.b(p.a.heir.mnemonic,p.a.heir.derivationPath,t),a=n.child,r=n.address,i=l.d({childPerson:a,redeemScript:e.from(this.props.redeem,"hex"),txid:this.props.utxo.transaction_hash,output:this.props.utxo.index,amount:this.props.utxo.value,fee:p.a.fee,sequenceFeed:p.a.sequenceFeed,network:t});l.a(i.toHex()),this.props.actions.sendToHeir(r)}},{key:"render",value:function(){return u.a.createElement("div",{style:{wordWrap:"break-word"}},u.a.createElement("p",null,u.a.createElement("strong",null,"UTXO ",this.props.index+1)),u.a.createElement("span",null,"Tx hash: ",this.props.utxo.transaction_hash),u.a.createElement("br",null),u.a.createElement("span",null,"Index: ",this.props.utxo.index),u.a.createElement("br",null),u.a.createElement("span",null,"Value: ",this.props.utxo.value/Math.pow(10,8)+" BTC"),u.a.createElement("br",null),u.a.createElement("span",null,"Block: ",this.props.utxo.block_id),u.a.createElement("br",null),u.a.createElement("br",null),this.getActionButtons(this.props.actions),u.a.createElement("br",null),u.a.createElement("br",null))}}]),n}(u.a.Component);t.a=m}).call(this,n(1).Buffer)},113:function(e,t,n){e.exports=n(248)},124:function(e,t){},126:function(e,t){},144:function(e,t){},147:function(e,t){},248:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(111),o=n.n(i),s=(n(118),n(46)),c=n(14),d=n(15),u=n(17),l=n(16),p=n(9),m=n(18),h=n(33),f=n.n(h),v=n(44),b=n(112),k=n(45),w=n.n(k),O=n(3),x=n(6),E=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).loadingUTXOs=!1,n.state={needToRerenderUTXOs:!1,utxos:[]},n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.updateUTXOList(this.props.address)}},{key:"shouldComponentUpdate",value:function(e,t){return e.address!==this.props.address?(this.updateUTXOList(e.address),!0):t.needToRerenderUTXOs}},{key:"componentDidUpdate",value:function(e,t,n){!t&&this.state.needToRerenderUTXOs&&this.setState({needToRerenderUTXOs:!1})}},{key:"updateUTXOList",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x.g(t).isValid){e.next=2;break}return e.abrupt("return");case 2:return this.loadingUTXOs=!0,n="".concat(O.a.apiURIs.address,"/").concat(t),e.next=6,w.a.get(n).catch((function(e){return alert("Blockchain API request error: "+e)}));case 6:a=e.sent,console.log("Fetching for ".concat(t)),this.loadingUTXOs=!1,this.setState({needToRerenderUTXOs:!0,utxos:a.data.data[t].utxo});case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAllUtxo",value:function(){var e=this;if(this.loadingUTXOs)return r.a.createElement("div",null,"Loading...");var t=this.state.utxos;return t.length?t.map((function(t,n){return r.a.createElement(b.a,{key:n,index:n,utxo:t,redeem:e.props.redeem,actions:e.props.actions})})):r.a.createElement("div",null,"No UTXOs")}},{key:"getHeader",value:function(){var e=x.g(this.props.address),t=this.props.redeem?r.a.createElement("p",null,"Redeem: ",this.props.redeem):"",n=this.props.info?r.a.createElement("p",null,"Info: ",JSON.stringify(this.props.info,null,"\t")):"";return e.isValid?r.a.createElement("div",{style:{wordWrap:"break-word"}},r.a.createElement("h4",null,this.props.address),t,r.a.createElement("br",null),n,r.a.createElement("br",null)):r.a.createElement("h4",null,"Address is not valid: ",e.message)}},{key:"render",value:function(){return r.a.createElement("div",{className:"content"},this.getHeader(),this.getAllUtxo())}}]),t}(r.a.Component),g=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.person,n=e.mnemonic,a=e.updateMnemonic,i=O.a[t],o=i.derivationPath,s=i.name,c=O.a.network,d=(Object(x.c)(n)?Object(x.b)(n,o,c):{}).address;return r.a.createElement("div",{className:"ui card"},r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"header"},s)),r.a.createElement("div",{className:"content"},r.a.createElement("form",null,r.a.createElement("label",{htmlFor:"mnemonic"}),r.a.createElement("br",null),r.a.createElement("textarea",{id:"mnemonic",name:"mnemonic",cols:"30",rows:"3",onChange:function(e){return a(t,e.target.value)},defaultValue:n})),r.a.createElement("p",{style:{color:"red"}},Object(x.c)(n)?"":"Mnemonic is not valid! Please enter valid mnemonic"),r.a.createElement("p",null,"Derivation path: ",o)),r.a.createElement("div",{className:"content"},r.a.createElement(E,{address:d,actions:this.props.actions})))}}]),t}(r.a.Component),y=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).broadcast=n.broadcast.bind(Object(p.a)(n)),n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"broadcast",value:function(){x.a(this.props.tx.raw),this.props.removeTx(this.props.tx.id),this.props.addIntermediate({address:this.props.tx.address,redeem:this.props.tx.redeem,info:this.props.tx.info})}},{key:"render",value:function(){return r.a.createElement("div",{className:"content",style:{wordWrap:"break-word"}},r.a.createElement("h4",null,"Txid: ",this.props.tx.id),r.a.createElement("p",null,this.props.tx.raw),r.a.createElement("p",null,JSON.stringify(this.props.tx.info,null,"\t")),r.a.createElement("p",null,r.a.createElement("button",{onClick:this.broadcast},"Broadcast")))}}]),t}(r.a.Component);var T=function(e){return r.a.createElement("div",{className:"ui card"},r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"header"},"Transactions")),e.txs.map((function(t,n){return r.a.createElement(y,{key:n,tx:t,removeTx:e.removeTx,addIntermediate:e.addIntermediate})})))},j=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(d.a)(t,[{key:"getAddressUtxoLists",value:function(){var e=this;return this.props.addressesData.map((function(t,n){return r.a.createElement(E,{key:n,address:t.address,redeem:t.redeem,info:t.info,actions:e.props.actions})}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"ui card"},r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"header"},"Intermediate addresses")),this.getAddressUtxoLists())}}]),t}(r.a.Component),S=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={owner:O.a.owner,heir:O.a.heir,network:O.a.network};var a=n.state,r=a.owner,i=a.heir,o=a.network;return Object.assign(n.state,n.getStorage(r,i,o)),n.updateMnemonic=n.updateMnemonic.bind(Object(p.a)(n)),n.addTx=n.addTx.bind(Object(p.a)(n)),n.removeTx=n.removeTx.bind(Object(p.a)(n)),n.addIntermediate=n.addIntermediate.bind(Object(p.a)(n)),n.removeIntermediate=n.removeIntermediate.bind(Object(p.a)(n)),n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"getStorageKey",value:function(e,t,n){var a=Object(x.b)(e.mnemonic,e.derivationPath,n).address,r=Object(x.b)(t.mnemonic,t.derivationPath,n).address;return"".concat(a,"_").concat(r)}},{key:"getStorage",value:function(e,t,n){var a=JSON.parse(localStorage.getItem(this.getStorageKey(e,t,n)));return{intermediate:a?a.intermediate:[],txs:a?a.txs:[]}}},{key:"setStorage",value:function(e){var t=e.owner,n=e.heir,a=e.network,r=e.storage;localStorage.setItem(this.getStorageKey(t,n,a),JSON.stringify(r))}},{key:"updateMnemonic",value:function(e,t){var n=this.state,a=n.owner,r=n.heir,i=n.network;"owner"===e?a.mnemonic=t:r.mnemonic=t;var o=this.getStorage(a,r,i),c=Object.assign({},this.state,Object(s.a)({},e,Object.assign({},this.state[e],{mnemonic:t})),o);this.setState((function(e,t){return c}))}},{key:"addStateData",value:function(e,t,n){var a,r=this;if(0===this.state[t].filter((function(t){return t[n]===e[n]})).length)a=this.state[t].concat([e]);else{var i=(a=this.state[t].slice()).indexOf((function(t){return t[n]===e[n]}));a[i]=e}this.setState((function(e){var n=r.state,i=n.owner,o=n.heir,c=n.network,d=r.getStorage(i,o,c);return d[t]=a,r.setStorage({owner:i,heir:o,network:c,storage:d}),Object(s.a)({},t,a)}))}},{key:"removeStateData",value:function(e,t,n){var a=this,r=this.state[e].filter((function(e){return e[t]===n}));if(0!==r.length){var i=this.state[e].slice(),o=this.state[e].indexOf(r[0]);i.splice(o,1),this.setState((function(t){var n=a.state,r=n.owner,o=n.heir,c=n.network,d=a.getStorage(r,o,c);return d[e]=i,a.setStorage({owner:r,heir:o,network:c,storage:d}),Object(s.a)({},e,i)}))}}},{key:"addTx",value:function(e){this.addStateData(e,"txs","id")}},{key:"removeTx",value:function(e){this.removeStateData("txs","id",e)}},{key:"addIntermediate",value:function(e){this.addStateData(e,"intermediate","address")}},{key:"removeIntermediate",value:function(e){this.removeStateData("intermediate","address",e)}},{key:"render",value:function(){return r.a.createElement("div",{className:"ui container"},r.a.createElement("p",null),r.a.createElement("h2",{className:"ui header center aligned"},"Safe Bitcoin inheritance"),r.a.createElement("p",null,"This Proof-of-Concept represents secure and convenient Bitcoin transfer from owner to heir(recovery) party in case if owner's keys are lost or some accident happens. This is trustless model between owner and heir as long as owner has exclusive control of her private keys. Heir delay time is fixed and equals to 6 Bitcoin blocks."),r.a.createElement("p",null,"Please refere to ",r.a.createElement("a",{href:"https://bitcointalk.org/index.php?topic=5185907.0"},"this Bitcointalk discussion")," for more motivation info and details."),r.a.createElement("p",{style:{color:"red"}},"It works on Bitcoin TESTNET."),r.a.createElement("p",{style:{color:"red"}},"Please DON'T use mnemonics from your Bitcoin mainnet funds! That is potentially not safe."),r.a.createElement("div",{className:"ui four column doubling stackable grid container"},r.a.createElement("div",{className:"column"},r.a.createElement(g,{mnemonic:this.state.owner.mnemonic,person:"owner",updateMnemonic:this.updateMnemonic,actions:{addTx:this.addTx}})),r.a.createElement("div",{className:"column"},r.a.createElement(T,{txs:this.state.txs,removeTx:this.removeTx,addIntermediate:this.addIntermediate})),r.a.createElement("div",{className:"column"},r.a.createElement(j,{addressesData:this.state.intermediate,actions:{sendToOwner:this.removeIntermediate,sendToHeir:this.removeIntermediate}})),r.a.createElement("div",{className:"column"},r.a.createElement(g,{mnemonic:this.state.heir.mnemonic,person:"heir",updateMnemonic:this.updateMnemonic,actions:{}}))))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(S,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},3:function(e,t,n){"use strict";var a=n(5),r={network:a.networks.testnet,apiURIs:{address:"https://api.blockchair.com/bitcoin/testnet/dashboards/address",pushTx:"https://api.blockchair.com/bitcoin/testnet/push/transaction"},owner:{name:"Alice (owner)",mnemonic:"",derivationPath:"m/44'/1'/0'/0/0"},heir:{name:"Bob (heir)",mnemonic:"",derivationPath:"m/44'/1'/0'/0/0"},sequenceFeed:{blocks:6},fee:1e4};t.a=r},6:function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return v})),n.d(t,"f",(function(){return b})),n.d(t,"e",(function(){return k})),n.d(t,"d",(function(){return w})),n.d(t,"g",(function(){return x})),n.d(t,"a",(function(){return E})),n.d(t,"c",(function(){return y}));var a=n(33),r=n.n(a),i=n(44),o=n(5),s=n(68),c=n(69),d=n(70),u=n.n(d),l=n(3),p=n(31),m=n.n(p),h=n(45),f=n.n(h);function v(e,t,n){var a=c.mnemonicToSeedSync(e),r=s.fromSeed(a).derivePath(t);return{child:r,address:o.payments.p2pkh({pubkey:r.publicKey,network:n}).address,publicKey:r.publicKey}}function b(e){var t=e.childOwner,n=e.childHeir,a=e.txid,r=e.output,i=e.amount,s=e.fee,c=e.sequenceFeed,d=e.network,p=function(e,t,n){var a=o.script.number.encode(n).toString("hex"),r=e.pubkey.toString("hex"),i=t.pubkey.toString("hex");return o.script.fromASM("\n      OP_IF\n        ".concat(r,"\n        OP_CHECKSIG\n      OP_ELSE\n        ").concat(a,"\n        OP_CHECKSEQUENCEVERIFY\n        OP_DROP\n        ").concat(i,"\n        OP_CHECKSIG\n      OP_ENDIF\n    ").trim().replace(/\s+/g," "))}(o.payments.p2pkh({pubkey:t.publicKey,network:d}),o.payments.p2pkh({pubkey:n.publicKey,network:d}),u.a.encode(c)),m=o.payments.p2sh({redeem:{output:p},network:l.a.network}),h=new o.TransactionBuilder(d);h.addInput(a,r),h.addOutput(m.address,i-s);var f=o.ECPair.fromPrivateKey(t.privateKey,{compressed:!0,network:d});h.sign(0,f);var v=h.build();return{raw:v.toHex(),id:v.getId(),redeem:p.toString("hex"),lockFeed:c,address:m.address}}function k(e){return O(!0,e)}function w(e){return O(!1,e)}function O(t,n){var a=n.childPerson,r=n.redeemScript,i=n.txid,s=n.output,c=n.amount,d=n.fee,l=n.network,p=n.sequenceFeed,m=o.payments.p2sh({redeem:{output:r},network:l}),h=o.payments.p2pkh({pubkey:a.publicKey,network:l}),f=new o.Transaction;f.version=2,t?f.addInput(e.from(i,"hex").reverse(),s):f.addInput(e.from(i,"hex").reverse(),s,u.a.encode(p)),f.addOutput(o.address.toOutputScript(h.address,l),c-d);var v=f.hashForSignature(0,m.redeem.output,o.Transaction.SIGHASH_ALL),b=o.ECPair.fromPrivateKey(a.privateKey,{compressed:!0,network:l}),k=t?o.opcodes.OP_TRUE:o.opcodes.OP_0,w=o.payments.p2sh({network:l,redeem:{network:l,output:m.redeem.output,input:o.script.compile([o.script.signature.encode(b.sign(v),o.Transaction.SIGHASH_ALL),k])}}).input;return f.setInputScript(0,w),f}function x(e){var t,n=!1;try{t=(n=21===m.a.decode(e).length)?"":"Wrong address length"}catch(a){t="Error decoding base58check: "+a.message}return{isValid:n,message:t}}function E(e){return g.apply(this,arguments)}function g(){return(g=Object(i.a)(r.a.mark((function e(t){var n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.a.apiURIs.pushTx,e.next=3,f.a.post(n,{data:t},{headers:{"Content-Type":"application/json;charset=UTF-8"}}).catch((function(e){return alert("Blockchain API request error: "+e)}));case 3:(a=e.sent)&&alert("Broadcasted with message: "+JSON.stringify(a));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return c.validateMnemonic(e)}}).call(this,n(1).Buffer)}},[[113,1,2]]]);
//# sourceMappingURL=main.960c8216.chunk.js.map